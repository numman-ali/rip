#!/usr/bin/env python3
import json
import os
from pathlib import Path

schema_dir = Path(os.environ.get("OPENRESPONSES_SCHEMA_DIR", "temp/openresponses/schema/components/schemas"))

if not schema_dir.exists():
    raise SystemExit(f"schema dir not found: {schema_dir}")

allowed = []
for path in schema_dir.glob("*StreamingEvent.json"):
    try:
        data = json.loads(path.read_text())
    except Exception:
        continue
    type_info = data.get("properties", {}).get("type", {})
    enum = type_info.get("enum")
    if isinstance(enum, list) and enum:
        allowed.append(enum[0])

allowed = sorted(set(allowed))

out_path = Path("schemas/openresponses/streaming_event_types.json")
out_path.parent.mkdir(parents=True, exist_ok=True)
out_path.write_text(json.dumps(allowed, indent=2) + "\n")
print(f"wrote {out_path} ({len(allowed)} types)")

{
  "openapi": "3.1.0",
  "info": {
    "title": "RIP Agent Server",
    "description": "Agent session control plane (HTTP/SSE).",
    "license": {
      "name": ""
    },
    "version": "0.1.0"
  },
  "paths": {
    "/sessions": {
      "post": {
        "operationId": "create_session",
        "responses": {
          "201": {
            "description": "Session created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SessionCreated"
                }
              }
            }
          }
        }
      }
    },
    "/sessions/{id}/cancel": {
      "post": {
        "operationId": "cancel_session",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Session id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Session canceled"
          },
          "404": {
            "description": "Session not found"
          }
        }
      }
    },
    "/sessions/{id}/events": {
      "get": {
        "operationId": "stream_events",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Session id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "SSE stream of event frames"
          },
          "404": {
            "description": "Session not found"
          }
        }
      }
    },
    "/sessions/{id}/input": {
      "post": {
        "operationId": "send_input",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Session id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/InputPayload"
              }
            }
          },
          "required": true
        },
        "responses": {
          "202": {
            "description": "Input accepted"
          },
          "404": {
            "description": "Session not found"
          }
        }
      }
    },
    "/tasks": {
      "get": {
        "operationId": "list_tasks",
        "responses": {
          "200": {
            "description": "List tasks",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/TaskStatusResponse"
                  }
                }
              }
            }
          }
        }
      },
      "post": {
        "operationId": "create_task",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TaskSpawnPayload"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "description": "Task created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TaskCreated"
                }
              }
            }
          },
          "400": {
            "description": "Invalid task request"
          }
        }
      }
    },
    "/tasks/{id}": {
      "get": {
        "operationId": "task_status",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Task id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Task status",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TaskStatusResponse"
                }
              }
            }
          },
          "404": {
            "description": "Task not found"
          }
        }
      }
    },
    "/tasks/{id}/cancel": {
      "post": {
        "operationId": "cancel_task",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Task id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TaskCancelPayload"
              }
            }
          },
          "required": true
        },
        "responses": {
          "202": {
            "description": "Cancel requested"
          },
          "404": {
            "description": "Task not found"
          }
        }
      }
    },
    "/tasks/{id}/events": {
      "get": {
        "operationId": "stream_task_events",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Task id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "SSE stream of task event frames"
          },
          "404": {
            "description": "Task not found"
          }
        }
      }
    },
    "/tasks/{id}/output": {
      "get": {
        "operationId": "task_output",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Task id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Fetch task output (range)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TaskOutputResponse"
                }
              }
            }
          },
          "404": {
            "description": "Task not found"
          }
        }
      }
    },
    "/tasks/{id}/resize": {
      "post": {
        "operationId": "task_resize",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Task id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TaskResizePayload"
              }
            }
          },
          "required": true
        },
        "responses": {
          "202": {
            "description": "Resize accepted"
          },
          "400": {
            "description": "Invalid resize request"
          },
          "404": {
            "description": "Task not found"
          }
        }
      }
    },
    "/tasks/{id}/signal": {
      "post": {
        "operationId": "task_signal",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Task id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TaskSignalPayload"
              }
            }
          },
          "required": true
        },
        "responses": {
          "202": {
            "description": "Signal accepted"
          },
          "400": {
            "description": "Invalid signal request"
          },
          "404": {
            "description": "Task not found"
          }
        }
      }
    },
    "/tasks/{id}/stdin": {
      "post": {
        "operationId": "task_write_stdin",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Task id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TaskWriteStdinPayload"
              }
            }
          },
          "required": true
        },
        "responses": {
          "202": {
            "description": "Stdin accepted"
          },
          "400": {
            "description": "Invalid stdin request"
          },
          "404": {
            "description": "Task not found"
          }
        }
      }
    },
    "/threads": {
      "get": {
        "operationId": "thread_list",
        "responses": {
          "200": {
            "description": "List threads",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/ThreadMeta"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/threads/ensure": {
      "post": {
        "operationId": "thread_ensure",
        "responses": {
          "200": {
            "description": "Default thread ensured",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ThreadEnsureResponse"
                }
              }
            }
          }
        }
      }
    },
    "/threads/{id}": {
      "get": {
        "operationId": "thread_get",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Thread id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Thread metadata",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ThreadMeta"
                }
              }
            }
          },
          "404": {
            "description": "Thread not found"
          }
        }
      }
    },
    "/threads/{id}/branch": {
      "post": {
        "operationId": "thread_branch",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Parent thread id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ThreadBranchPayload"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "description": "Branch created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ThreadBranchResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid branch request"
          },
          "404": {
            "description": "Thread or branch point not found"
          }
        }
      }
    },
    "/threads/{id}/compaction-auto": {
      "post": {
        "operationId": "thread_compaction_auto",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Thread id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CompactionAutoV1Request"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Auto-compaction no-op / dry-run result",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CompactionAutoV1Response"
                }
              }
            }
          },
          "202": {
            "description": "Auto-compaction job spawned",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CompactionAutoV1Response"
                }
              }
            }
          },
          "400": {
            "description": "Invalid auto-compaction request"
          },
          "404": {
            "description": "Thread not found"
          }
        }
      }
    },
    "/threads/{id}/compaction-auto-schedule": {
      "post": {
        "operationId": "thread_compaction_auto_schedule",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Thread id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CompactionAutoScheduleV1Request"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Scheduler no-op / dry-run / skipped result",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CompactionAutoScheduleV1Response"
                }
              }
            }
          },
          "202": {
            "description": "Scheduler started a job",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CompactionAutoScheduleV1Response"
                }
              }
            }
          },
          "400": {
            "description": "Invalid schedule request"
          },
          "404": {
            "description": "Thread not found"
          }
        }
      }
    },
    "/threads/{id}/compaction-checkpoint": {
      "post": {
        "operationId": "thread_compaction_checkpoint",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Thread id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ThreadCompactionCheckpointPayload"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "description": "Compaction checkpoint created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ThreadCompactionCheckpointResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid checkpoint request"
          },
          "404": {
            "description": "Thread or cut point not found"
          }
        }
      }
    },
    "/threads/{id}/compaction-cut-points": {
      "post": {
        "operationId": "thread_compaction_cut_points",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Thread id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CompactionCutPointsV1Request"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Computed cut points",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CompactionCutPointsV1Response"
                }
              }
            }
          },
          "400": {
            "description": "Invalid cut point request"
          },
          "404": {
            "description": "Thread not found"
          }
        }
      }
    },
    "/threads/{id}/compaction-status": {
      "post": {
        "operationId": "thread_compaction_status",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Thread id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CompactionStatusV1Request"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Compaction status projection",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CompactionStatusV1Response"
                }
              }
            }
          },
          "400": {
            "description": "Invalid status request"
          },
          "404": {
            "description": "Thread not found"
          }
        }
      }
    },
    "/threads/{id}/context-selection-status": {
      "post": {
        "operationId": "thread_context_selection_status",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Thread id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ContextSelectionStatusV1Request"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Context selection strategy decisions (truth-derived)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ContextSelectionStatusV1Response"
                }
              }
            }
          },
          "404": {
            "description": "Thread not found"
          }
        }
      }
    },
    "/threads/{id}/events": {
      "get": {
        "operationId": "thread_stream_events",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Thread id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "SSE stream of thread event frames"
          },
          "404": {
            "description": "Thread not found"
          }
        }
      }
    },
    "/threads/{id}/handoff": {
      "post": {
        "operationId": "thread_handoff",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Source thread id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ThreadHandoffPayload"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "description": "Handoff thread created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ThreadHandoffResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid handoff request"
          },
          "404": {
            "description": "Thread or handoff point not found"
          }
        }
      }
    },
    "/threads/{id}/messages": {
      "post": {
        "operationId": "thread_post_message",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Thread id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ThreadPostMessagePayload"
              }
            }
          },
          "required": true
        },
        "responses": {
          "202": {
            "description": "Message accepted and run started",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ThreadPostMessageResponse"
                }
              }
            }
          },
          "404": {
            "description": "Thread not found"
          }
        }
      }
    },
    "/threads/{id}/provider-cursor-rotate": {
      "post": {
        "operationId": "thread_provider_cursor_rotate",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Thread id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ProviderCursorRotateV1Request"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Provider cursor rotation logged",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProviderCursorRotateV1Response"
                }
              }
            }
          },
          "404": {
            "description": "Thread not found"
          }
        }
      }
    },
    "/threads/{id}/provider-cursor-status": {
      "post": {
        "operationId": "thread_provider_cursor_status",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "Thread id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ProviderCursorStatusV1Request"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Provider cursor status projection",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProviderCursorStatusV1Response"
                }
              }
            }
          },
          "404": {
            "description": "Thread not found"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "ApiToolTaskExecutionMode": {
        "type": "string",
        "enum": [
          "pipes",
          "pty"
        ]
      },
      "ApiToolTaskStatus": {
        "type": "string",
        "enum": [
          "queued",
          "running",
          "exited",
          "cancelled",
          "failed"
        ]
      },
      "CompactionAutoResultCheckpointV1": {
        "type": "object",
        "required": [
          "checkpoint_id",
          "summary_artifact_id",
          "to_seq",
          "to_message_id",
          "cut_rule_id"
        ],
        "properties": {
          "checkpoint_id": {
            "type": "string"
          },
          "cut_rule_id": {
            "type": "string"
          },
          "summary_artifact_id": {
            "type": "string"
          },
          "to_message_id": {
            "type": "string"
          },
          "to_seq": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          }
        }
      },
      "CompactionAutoScheduleV1Request": {
        "type": "object",
        "required": [
          "actor_id",
          "origin"
        ],
        "properties": {
          "actor_id": {
            "type": "string"
          },
          "block_on_inflight": {
            "type": [
              "boolean",
              "null"
            ]
          },
          "dry_run": {
            "type": [
              "boolean",
              "null"
            ]
          },
          "execute": {
            "type": [
              "boolean",
              "null"
            ]
          },
          "max_new_checkpoints": {
            "type": [
              "integer",
              "null"
            ],
            "format": "int32",
            "minimum": 0
          },
          "origin": {
            "type": "string"
          },
          "stride_messages": {
            "type": [
              "integer",
              "null"
            ],
            "format": "int64",
            "minimum": 0
          }
        }
      },
      "CompactionAutoScheduleV1Response": {
        "type": "object",
        "required": [
          "thread_id",
          "policy_id",
          "decision",
          "execute",
          "stride_messages",
          "max_new_checkpoints",
          "block_on_inflight",
          "message_count",
          "cut_rule_id",
          "planned",
          "result"
        ],
        "properties": {
          "block_on_inflight": {
            "type": "boolean"
          },
          "cut_rule_id": {
            "type": "string"
          },
          "decision": {
            "type": "string"
          },
          "decision_id": {
            "type": [
              "string",
              "null"
            ]
          },
          "error": {
            "type": [
              "string",
              "null"
            ]
          },
          "execute": {
            "type": "boolean"
          },
          "job_id": {
            "type": [
              "string",
              "null"
            ]
          },
          "job_kind": {
            "type": [
              "string",
              "null"
            ]
          },
          "max_new_checkpoints": {
            "type": "integer",
            "format": "int32",
            "minimum": 0
          },
          "message_count": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          },
          "planned": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CompactionPlannedCutPointV1"
            }
          },
          "policy_id": {
            "type": "string"
          },
          "result": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CompactionAutoResultCheckpointV1"
            }
          },
          "stride_messages": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          },
          "thread_id": {
            "type": "string"
          }
        }
      },
      "CompactionAutoV1Request": {
        "type": "object",
        "required": [
          "actor_id",
          "origin"
        ],
        "properties": {
          "actor_id": {
            "type": "string"
          },
          "dry_run": {
            "type": [
              "boolean",
              "null"
            ]
          },
          "max_new_checkpoints": {
            "type": [
              "integer",
              "null"
            ],
            "format": "int32",
            "minimum": 0
          },
          "origin": {
            "type": "string"
          },
          "stride_messages": {
            "type": [
              "integer",
              "null"
            ],
            "format": "int64",
            "minimum": 0
          }
        }
      },
      "CompactionAutoV1Response": {
        "type": "object",
        "required": [
          "thread_id",
          "status",
          "stride_messages",
          "message_count",
          "cut_rule_id",
          "planned",
          "result"
        ],
        "properties": {
          "cut_rule_id": {
            "type": "string"
          },
          "error": {
            "type": [
              "string",
              "null"
            ]
          },
          "job_id": {
            "type": [
              "string",
              "null"
            ]
          },
          "job_kind": {
            "type": [
              "string",
              "null"
            ]
          },
          "message_count": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          },
          "planned": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CompactionPlannedCutPointV1"
            }
          },
          "result": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CompactionAutoResultCheckpointV1"
            }
          },
          "status": {
            "type": "string"
          },
          "stride_messages": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          },
          "thread_id": {
            "type": "string"
          }
        }
      },
      "CompactionCutPointV1": {
        "type": "object",
        "required": [
          "target_message_ordinal",
          "to_seq",
          "to_message_id",
          "already_checkpointed"
        ],
        "properties": {
          "already_checkpointed": {
            "type": "boolean"
          },
          "latest_checkpoint_id": {
            "type": [
              "string",
              "null"
            ]
          },
          "target_message_ordinal": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          },
          "to_message_id": {
            "type": "string"
          },
          "to_seq": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          }
        }
      },
      "CompactionCutPointsV1Request": {
        "type": "object",
        "properties": {
          "limit": {
            "type": [
              "integer",
              "null"
            ],
            "format": "int32",
            "minimum": 0
          },
          "stride_messages": {
            "type": [
              "integer",
              "null"
            ],
            "format": "int64",
            "minimum": 0
          }
        }
      },
      "CompactionCutPointsV1Response": {
        "type": "object",
        "required": [
          "thread_id",
          "stride_messages",
          "message_count",
          "cut_rule_id",
          "cut_points"
        ],
        "properties": {
          "cut_points": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CompactionCutPointV1"
            }
          },
          "cut_rule_id": {
            "type": "string"
          },
          "message_count": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          },
          "stride_messages": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          },
          "thread_id": {
            "type": "string"
          }
        }
      },
      "CompactionPlannedCutPointV1": {
        "type": "object",
        "required": [
          "target_message_ordinal",
          "to_seq",
          "to_message_id"
        ],
        "properties": {
          "target_message_ordinal": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          },
          "to_message_id": {
            "type": "string"
          },
          "to_seq": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          }
        }
      },
      "CompactionStatusCheckpointV1": {
        "type": "object",
        "required": [
          "checkpoint_id",
          "cut_rule_id",
          "summary_kind",
          "summary_artifact_id",
          "to_seq"
        ],
        "properties": {
          "checkpoint_id": {
            "type": "string"
          },
          "cut_rule_id": {
            "type": "string"
          },
          "summary_artifact_id": {
            "type": "string"
          },
          "summary_kind": {
            "type": "string"
          },
          "to_message_id": {
            "type": [
              "string",
              "null"
            ]
          },
          "to_seq": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          }
        }
      },
      "CompactionStatusJobOutcomeV1": {
        "type": "object",
        "required": [
          "job_id",
          "job_kind",
          "status",
          "created",
          "actor_id",
          "origin",
          "seq",
          "timestamp_ms"
        ],
        "properties": {
          "actor_id": {
            "type": "string"
          },
          "created": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CompactionAutoResultCheckpointV1"
            }
          },
          "error": {
            "type": [
              "string",
              "null"
            ]
          },
          "job_id": {
            "type": "string"
          },
          "job_kind": {
            "type": "string"
          },
          "origin": {
            "type": "string"
          },
          "seq": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          },
          "status": {
            "type": "string"
          },
          "timestamp_ms": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          }
        }
      },
      "CompactionStatusScheduleDecisionV1": {
        "type": "object",
        "required": [
          "decision_id",
          "policy_id",
          "decision",
          "execute",
          "stride_messages",
          "max_new_checkpoints",
          "block_on_inflight",
          "message_count",
          "cut_rule_id",
          "planned",
          "actor_id",
          "origin",
          "seq",
          "timestamp_ms"
        ],
        "properties": {
          "actor_id": {
            "type": "string"
          },
          "block_on_inflight": {
            "type": "boolean"
          },
          "cut_rule_id": {
            "type": "string"
          },
          "decision": {
            "type": "string"
          },
          "decision_id": {
            "type": "string"
          },
          "execute": {
            "type": "boolean"
          },
          "job_id": {
            "type": [
              "string",
              "null"
            ]
          },
          "job_kind": {
            "type": [
              "string",
              "null"
            ]
          },
          "max_new_checkpoints": {
            "type": "integer",
            "format": "int32",
            "minimum": 0
          },
          "message_count": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          },
          "origin": {
            "type": "string"
          },
          "planned": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CompactionPlannedCutPointV1"
            }
          },
          "policy_id": {
            "type": "string"
          },
          "seq": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          },
          "stride_messages": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          },
          "timestamp_ms": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          }
        }
      },
      "CompactionStatusV1Request": {
        "type": "object",
        "properties": {
          "stride_messages": {
            "type": [
              "integer",
              "null"
            ],
            "format": "int64",
            "minimum": 0
          }
        }
      },
      "CompactionStatusV1Response": {
        "type": "object",
        "required": [
          "thread_id",
          "stride_messages",
          "message_count"
        ],
        "properties": {
          "inflight_job_id": {
            "type": [
              "string",
              "null"
            ]
          },
          "last_job_outcome": {
            "oneOf": [
              {
                "type": "null"
              },
              {
                "$ref": "#/components/schemas/CompactionStatusJobOutcomeV1"
              }
            ]
          },
          "last_schedule_decision": {
            "oneOf": [
              {
                "type": "null"
              },
              {
                "$ref": "#/components/schemas/CompactionStatusScheduleDecisionV1"
              }
            ]
          },
          "latest_checkpoint": {
            "oneOf": [
              {
                "type": "null"
              },
              {
                "$ref": "#/components/schemas/CompactionStatusCheckpointV1"
              }
            ]
          },
          "message_count": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          },
          "next_cut_point": {
            "oneOf": [
              {
                "type": "null"
              },
              {
                "$ref": "#/components/schemas/CompactionPlannedCutPointV1"
              }
            ]
          },
          "stride_messages": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          },
          "thread_id": {
            "type": "string"
          }
        }
      },
      "ContextSelectionStatusCheckpointV1": {
        "type": "object",
        "required": [
          "checkpoint_id",
          "summary_kind",
          "summary_artifact_id",
          "to_seq"
        ],
        "properties": {
          "checkpoint_id": {
            "type": "string"
          },
          "summary_artifact_id": {
            "type": "string"
          },
          "summary_kind": {
            "type": "string"
          },
          "to_seq": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          }
        }
      },
      "ContextSelectionStatusDecisionV1": {
        "type": "object",
        "required": [
          "decision_event_id",
          "run_session_id",
          "message_id",
          "compiler_id",
          "compiler_strategy",
          "limits",
          "resets",
          "actor_id",
          "origin",
          "seq",
          "timestamp_ms"
        ],
        "properties": {
          "actor_id": {
            "type": "string"
          },
          "compaction_checkpoint": {
            "oneOf": [
              {
                "type": "null"
              },
              {
                "$ref": "#/components/schemas/ContextSelectionStatusCheckpointV1"
              }
            ]
          },
          "compiler_id": {
            "type": "string"
          },
          "compiler_strategy": {
            "type": "string"
          },
          "decision_event_id": {
            "type": "string"
          },
          "limits": {},
          "message_id": {
            "type": "string"
          },
          "origin": {
            "type": "string"
          },
          "reason": {},
          "resets": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ContextSelectionStatusResetV1"
            }
          },
          "run_session_id": {
            "type": "string"
          },
          "seq": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          },
          "timestamp_ms": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          }
        }
      },
      "ContextSelectionStatusResetV1": {
        "type": "object",
        "required": [
          "input",
          "action",
          "reason"
        ],
        "properties": {
          "action": {
            "type": "string"
          },
          "input": {
            "type": "string"
          },
          "reason": {
            "type": "string"
          },
          "ref": {}
        }
      },
      "ContextSelectionStatusV1Request": {
        "type": "object",
        "properties": {
          "limit": {
            "type": [
              "integer",
              "null"
            ],
            "format": "int32",
            "minimum": 0
          }
        }
      },
      "ContextSelectionStatusV1Response": {
        "type": "object",
        "required": [
          "thread_id",
          "decisions"
        ],
        "properties": {
          "decisions": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ContextSelectionStatusDecisionV1"
            }
          },
          "thread_id": {
            "type": "string"
          }
        }
      },
      "InputPayload": {
        "type": "object",
        "required": [
          "input"
        ],
        "properties": {
          "input": {
            "type": "string"
          }
        }
      },
      "ProviderCursorRotateV1Request": {
        "type": "object",
        "required": [
          "actor_id",
          "origin"
        ],
        "properties": {
          "actor_id": {
            "type": "string"
          },
          "endpoint": {
            "type": [
              "string",
              "null"
            ]
          },
          "model": {
            "type": [
              "string",
              "null"
            ]
          },
          "origin": {
            "type": "string"
          },
          "provider": {
            "type": [
              "string",
              "null"
            ]
          },
          "reason": {
            "type": [
              "string",
              "null"
            ]
          }
        }
      },
      "ProviderCursorRotateV1Response": {
        "type": "object",
        "required": [
          "thread_id",
          "rotated"
        ],
        "properties": {
          "cursor_event_id": {
            "type": [
              "string",
              "null"
            ]
          },
          "endpoint": {
            "type": [
              "string",
              "null"
            ]
          },
          "model": {
            "type": [
              "string",
              "null"
            ]
          },
          "provider": {
            "type": [
              "string",
              "null"
            ]
          },
          "rotated": {
            "type": "boolean"
          },
          "thread_id": {
            "type": "string"
          }
        }
      },
      "ProviderCursorStatusCursorV1": {
        "type": "object",
        "required": [
          "cursor_event_id",
          "provider",
          "action",
          "actor_id",
          "origin",
          "seq",
          "timestamp_ms"
        ],
        "properties": {
          "action": {
            "type": "string"
          },
          "actor_id": {
            "type": "string"
          },
          "cursor": {},
          "cursor_event_id": {
            "type": "string"
          },
          "endpoint": {
            "type": [
              "string",
              "null"
            ]
          },
          "model": {
            "type": [
              "string",
              "null"
            ]
          },
          "origin": {
            "type": "string"
          },
          "provider": {
            "type": "string"
          },
          "reason": {
            "type": [
              "string",
              "null"
            ]
          },
          "run_session_id": {
            "type": [
              "string",
              "null"
            ]
          },
          "seq": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          },
          "timestamp_ms": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          }
        }
      },
      "ProviderCursorStatusV1Request": {
        "type": "object"
      },
      "ProviderCursorStatusV1Response": {
        "type": "object",
        "required": [
          "thread_id",
          "cursors"
        ],
        "properties": {
          "active": {
            "oneOf": [
              {
                "type": "null"
              },
              {
                "$ref": "#/components/schemas/ProviderCursorStatusCursorV1"
              }
            ]
          },
          "cursors": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ProviderCursorStatusCursorV1"
            }
          },
          "thread_id": {
            "type": "string"
          }
        }
      },
      "SessionCreated": {
        "type": "object",
        "required": [
          "session_id"
        ],
        "properties": {
          "session_id": {
            "type": "string"
          }
        }
      },
      "TaskCancelPayload": {
        "type": "object",
        "properties": {
          "reason": {
            "type": [
              "string",
              "null"
            ]
          }
        }
      },
      "TaskCreated": {
        "type": "object",
        "required": [
          "task_id"
        ],
        "properties": {
          "task_id": {
            "type": "string"
          }
        }
      },
      "TaskOutputResponse": {
        "type": "object",
        "required": [
          "task_id",
          "stream",
          "content",
          "offset_bytes",
          "bytes",
          "total_bytes",
          "truncated",
          "artifact_id",
          "path"
        ],
        "properties": {
          "artifact_id": {
            "type": "string"
          },
          "bytes": {
            "type": "integer",
            "minimum": 0
          },
          "content": {
            "type": "string"
          },
          "offset_bytes": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          },
          "path": {
            "type": "string"
          },
          "stream": {
            "$ref": "#/components/schemas/TaskOutputStream"
          },
          "task_id": {
            "type": "string"
          },
          "total_bytes": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          },
          "truncated": {
            "type": "boolean"
          }
        }
      },
      "TaskOutputStream": {
        "type": "string",
        "enum": [
          "stdout",
          "stderr",
          "pty"
        ]
      },
      "TaskResizePayload": {
        "type": "object",
        "required": [
          "rows",
          "cols"
        ],
        "properties": {
          "cols": {
            "type": "integer",
            "format": "int32",
            "minimum": 0
          },
          "rows": {
            "type": "integer",
            "format": "int32",
            "minimum": 0
          }
        }
      },
      "TaskSignalPayload": {
        "type": "object",
        "required": [
          "signal"
        ],
        "properties": {
          "signal": {
            "type": "string"
          }
        }
      },
      "TaskSpawnPayload": {
        "type": "object",
        "required": [
          "tool"
        ],
        "properties": {
          "args": {},
          "execution_mode": {
            "oneOf": [
              {
                "type": "null"
              },
              {
                "$ref": "#/components/schemas/ApiToolTaskExecutionMode"
              }
            ]
          },
          "origin_session_id": {
            "type": [
              "string",
              "null"
            ]
          },
          "title": {
            "type": [
              "string",
              "null"
            ]
          },
          "tool": {
            "type": "string"
          }
        }
      },
      "TaskStatusResponse": {
        "type": "object",
        "required": [
          "task_id",
          "status",
          "tool",
          "execution_mode"
        ],
        "properties": {
          "artifacts": {},
          "ended_at_ms": {
            "type": [
              "integer",
              "null"
            ],
            "format": "int64",
            "minimum": 0
          },
          "error": {
            "type": [
              "string",
              "null"
            ]
          },
          "execution_mode": {
            "$ref": "#/components/schemas/ApiToolTaskExecutionMode"
          },
          "exit_code": {
            "type": [
              "integer",
              "null"
            ],
            "format": "int32"
          },
          "started_at_ms": {
            "type": [
              "integer",
              "null"
            ],
            "format": "int64",
            "minimum": 0
          },
          "status": {
            "$ref": "#/components/schemas/ApiToolTaskStatus"
          },
          "task_id": {
            "type": "string"
          },
          "title": {
            "type": [
              "string",
              "null"
            ]
          },
          "tool": {
            "type": "string"
          }
        }
      },
      "TaskWriteStdinPayload": {
        "type": "object",
        "required": [
          "chunk_b64"
        ],
        "properties": {
          "chunk_b64": {
            "type": "string"
          }
        }
      },
      "ThreadBranchPayload": {
        "type": "object",
        "properties": {
          "actor_id": {
            "type": [
              "string",
              "null"
            ]
          },
          "from_message_id": {
            "type": [
              "string",
              "null"
            ]
          },
          "from_seq": {
            "type": [
              "integer",
              "null"
            ],
            "format": "int64",
            "minimum": 0
          },
          "origin": {
            "type": [
              "string",
              "null"
            ]
          },
          "title": {
            "type": [
              "string",
              "null"
            ]
          }
        }
      },
      "ThreadBranchResponse": {
        "type": "object",
        "required": [
          "thread_id",
          "parent_thread_id",
          "parent_seq"
        ],
        "properties": {
          "parent_message_id": {
            "type": [
              "string",
              "null"
            ]
          },
          "parent_seq": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          },
          "parent_thread_id": {
            "type": "string"
          },
          "thread_id": {
            "type": "string"
          }
        }
      },
      "ThreadCompactionCheckpointPayload": {
        "type": "object",
        "properties": {
          "actor_id": {
            "type": [
              "string",
              "null"
            ]
          },
          "origin": {
            "type": [
              "string",
              "null"
            ]
          },
          "stride_messages": {
            "type": [
              "integer",
              "null"
            ],
            "format": "int64",
            "minimum": 0
          },
          "summary_artifact_id": {
            "type": [
              "string",
              "null"
            ]
          },
          "summary_markdown": {
            "type": [
              "string",
              "null"
            ]
          },
          "to_message_id": {
            "type": [
              "string",
              "null"
            ]
          },
          "to_seq": {
            "type": [
              "integer",
              "null"
            ],
            "format": "int64",
            "minimum": 0
          }
        }
      },
      "ThreadCompactionCheckpointResponse": {
        "type": "object",
        "required": [
          "thread_id",
          "checkpoint_id",
          "cut_rule_id",
          "summary_artifact_id",
          "to_seq",
          "to_message_id"
        ],
        "properties": {
          "checkpoint_id": {
            "type": "string"
          },
          "cut_rule_id": {
            "type": "string"
          },
          "summary_artifact_id": {
            "type": "string"
          },
          "thread_id": {
            "type": "string"
          },
          "to_message_id": {
            "type": "string"
          },
          "to_seq": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          }
        }
      },
      "ThreadEnsureResponse": {
        "type": "object",
        "required": [
          "thread_id"
        ],
        "properties": {
          "thread_id": {
            "type": "string"
          }
        }
      },
      "ThreadHandoffPayload": {
        "type": "object",
        "properties": {
          "actor_id": {
            "type": [
              "string",
              "null"
            ]
          },
          "from_message_id": {
            "type": [
              "string",
              "null"
            ]
          },
          "from_seq": {
            "type": [
              "integer",
              "null"
            ],
            "format": "int64",
            "minimum": 0
          },
          "origin": {
            "type": [
              "string",
              "null"
            ]
          },
          "summary_artifact_id": {
            "type": [
              "string",
              "null"
            ]
          },
          "summary_markdown": {
            "type": [
              "string",
              "null"
            ]
          },
          "title": {
            "type": [
              "string",
              "null"
            ]
          }
        }
      },
      "ThreadHandoffResponse": {
        "type": "object",
        "required": [
          "thread_id",
          "from_thread_id",
          "from_seq"
        ],
        "properties": {
          "from_message_id": {
            "type": [
              "string",
              "null"
            ]
          },
          "from_seq": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          },
          "from_thread_id": {
            "type": "string"
          },
          "thread_id": {
            "type": "string"
          }
        }
      },
      "ThreadMeta": {
        "type": "object",
        "required": [
          "thread_id",
          "created_at_ms",
          "archived"
        ],
        "properties": {
          "archived": {
            "type": "boolean"
          },
          "created_at_ms": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          },
          "thread_id": {
            "type": "string"
          },
          "title": {
            "type": [
              "string",
              "null"
            ]
          }
        }
      },
      "ThreadPostMessagePayload": {
        "type": "object",
        "required": [
          "content"
        ],
        "properties": {
          "actor_id": {
            "type": [
              "string",
              "null"
            ]
          },
          "content": {
            "type": "string"
          },
          "origin": {
            "type": [
              "string",
              "null"
            ]
          }
        }
      },
      "ThreadPostMessageResponse": {
        "type": "object",
        "required": [
          "thread_id",
          "message_id",
          "session_id"
        ],
        "properties": {
          "message_id": {
            "type": "string"
          },
          "session_id": {
            "type": "string"
          },
          "thread_id": {
            "type": "string"
          }
        }
      }
    }
  }
}
